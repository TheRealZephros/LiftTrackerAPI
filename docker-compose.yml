version: "3.8"

services:
  seq:
    image: datalust/seq:latest
    container_name: seq
    ports:
      - "5341:80"   # Seq UI & ingestion
    environment:
      ACCEPT_EULA: "Y"
      SEQ_FSPATH: "/data"  # Seq persistent storage
      SEQ_LOGLEVEL: "Information"
      SEQ_USERNAME: "admin"        # Optional: enable basic auth
      SEQ_PASSWORD: "YourStrongPassword"
    volumes:
      - ./seq-data:/data   # persist logs across container restarts
    restart: unless-stopped

  api:
    build:
      context: ./api
      dockerfile: Dockerfile
    container_name: demo-api
    ports:
      - "5000:80" # maps API container port 80 to host port 5000
    environment:
      ASPNETCORE_ENVIRONMENT: "Development"
      ConnectionStrings__DefaultConnection: "Server=db;Database=DemoDb;User Id=sa;Password=YourStrongPassword123;"
      JWT__Issuer: "YourIssuer"
      JWT__Audience: "YourAudience"
      JWT__SigningKey: "YourSuperSecretSigningKey123!"
      Seq__ServerUrl: "http://seq:5341" # point API logs to Seq service
    depends_on:
      - seq
      - db
    restart: unless-stopped

  db:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: demo-db
    environment:
      SA_PASSWORD: "YourStrongPassword123!"
      ACCEPT_EULA: "Y"
    ports:
      - "1433:1433"
    volumes:
      - ./db-data:/var/opt/mssql   # persist database files
    restart: unless-stopped
